1
RepItem.wss
  ВВЕДИТЕ значение для изменения
//12 PUTLOG
// 2017 добавила передачу признака менять в доп. БД - [ ]
// 991^[ - признак подключить доп БД
// 991^] - список доп.БД
//991 условия замены в - ! факультет / специальность | направление + ФО = ВО
DEL
1000
*


ADD
1000

v991

//.................. Новое в 2017, в G100 имена доп. БД, в 101 имя текущей БД
IF
if val(v991^[)=1 and v991^]<>'' then '1' fi,,,,&uf('+7W101#'if &unifor('IPRIVATE,DBN,')<>'' then &unifor('IPRIVATE,DBN,') else 'IBIS' fi )
// список БД задан
REP
991^]
1
v991^] ,,,if v991^]: '.' then  else '.mnu' fi,,,,

ADD
991

(if  &uf('+5T',,&uf('Av991^]#1'),,)<>'' then &uf('+7U100#',&uf('+5T',,&uf('Av991^]#1'),,) ) else break fi/),,&uf('+7G100'),,,&uf('+7G100')

// добавляю текущую БД
IF
if s((if p(g100) then '!',g100,'!' fi)): s('!',g101,'!') then '0' else '1' fi
ADD
991

&uf('+7U100#',,g101)

FI
FI
IF
if val(v991^[)=0 and v991^]='' then '1' fi,,,,&uf('+7W100#',,g101)
//список БД не задан
FI
IF
if p(v991^A) then '1' else '0' fi
//----------------------------------------- специальность
PUTLOG
'Замена специальности ',v991^A,' на ',v991^1,,,,,,if val(v991^[)=1 then '. (Корректировка дополнительных БД каталога в ',,v991^],,')' fi 
PUTLOG
'LINKCORRTASK=REPCNA%DBN=VUZ%QUERY="DISCS=',,v991^A,'"+"VSPEC=',v991^A,'"%V991=',,"^A"v991^A,"^B"v991^1,,"^!"v991^!,,"^/"v991^/,,"^|"v991^|,,"^+"v991^+,,"^="v991^=,,,,'^CC%',
IF
if val(&unifor('IMAIN,ACCESSRDR,1'))=1 then '1' else '0' fi
PUTLOG
'LINKCORRTASK=RCHA90%DBN=RDR%QUERY="SPEC=',,v991^A,,,'"%V991=',"^A"v991^A,"^B"v991^1,'^CC',,'%'
FI
//................ для записей каталога - специальность
//имена БД каталога кладу из G100 в v994
DEL
994
*


ADD
994

(g100/)

REPEAT
PUTLOG
'LINKCORRTASK=REPCNA_M%DBN=',,&uf('Av994#1'),,'%QUERY="SPEC=',,v991^A,,,,,'"%V991=',,"^A"v991^A,"^B"v991^1,'^CC%'
DEL
994
1


UNTIL
if p(v994) then '1' fi
FI
//-----------------------
IF
if p(v991^B) then '1' else '0' fi
//--------------------------------------------------- направление
PUTLOG
'Замена направления ',v991^B,' на ',v991^2,,if val(v991^[)=1 then '. (Корректировка дополнительных БД каталога в ',,v991^],,')' fi
PUTLOG
'LINKCORRTASK=REPCNA%DBN=VUZ%QUERY="DISCNPR=',,v991^B,'"+"VNAPR=',v991^B,'"%V991=',,"^A"v991^B,"^B"v991^2,,,"^!"v991^!,,"^/"v991^/,,"^|"v991^|,,"^+"v991^+,,"^="v991^=,,,'^CN%'
IF
if val(&unifor('IMAIN,ACCESSRDR,1'))=1 then '1' else '0' fi
PUTLOG
'LINKCORRTASK=RCHA90%DBN=RDR%QUERY="NAPR=',,v991^B,,,'"%V991=',"^A"v991^B,"^B"v991^2,'^CN%'
FI
//................ для записей каталога - направление
//имена БД каталога кладу из G100 в v994
DEL
994
*


ADD
994

(g100/)

REPEAT
PUTLOG
'LINKCORRTASK=REPCNA_M%DBN=',,&uf('Av994#1'),,'%QUERY="NAPR=',,v991^B,,,,,'"%V991=',,"^A"v991^B,"^B"v991^2,'^CN%'
DEL
994
1


UNTIL
if p(v994) then '1' fi
FI
//--------------------------
IF
if p(v991^E) then '1' else '0' fi
//-------------------------------------------------------------------- факультет
PUTLOG
'Замена кода факультета ',v991^E,' на ',v991^5,,if val(v991^[)=1 then '. (Корректировка дополнительных БД каталога в ',,v991^],,')' fi
PUTLOG
'LINKCORRTASK=REPCNA%DBN=VUZ%QUERY="DISCFAK=',,v991^E,'"+"VFAK=',v991^E,'"%V991=',,"^A"v991^E,"^B"v991^5,,,"^!"v991^!,,"^/"v991^/,,"^|"v991^|,,"^+"v991^+,,"^="v991^=,,,,'^CA%'
IF
if val(&unifor('IMAIN,ACCESSRDR,1'))=1 then '1' else '0' fi
PUTLOG
'LINKCORRTASK=RCHA90%DBN=RDR%QUERY="FAK=',,v991^E,,,'"%V991=',"^A"v991^E,"^B"v991^5,'^CA%'
FI
//................ для записей каталога - факультет
//имена БД каталога кладу из G100 в v994
DEL
994
*


ADD
994

(g100/)

REPEAT
PUTLOG
'LINKCORRTASK=REPCNA_M%DBN=',,&uf('Av994#1'),,'%QUERY="FAK=',,v991^E,,,,,'"%V991=',,"^A"v991^E,"^B"v991^5,'^CA%'
DEL
994
1


UNTIL
if p(v994) then '1' fi
FI
//---------------------
IF
if p(v991^C) then '1' else '0' fi
//----------------------------------------------------------------------- кафедра читающая
PUTLOG
'Замена кода кафедры читающей ',v991^C,' на ',v991^3,,if val(v991^[)=1 then '. (Корректировка дополнительных БД каталога в ',,v991^],,')' fi
PUTLOG
'LINKCORRTASK=REPKFCH%DBN=VUZ%QUERY="DISCKH=',,v991^C,'"+"VKAF=',v991^C,'"%V991=',,"^A"v991^C,"^B"v991^3,,,,'^CH%'
IF
if val(&unifor('IMAIN,ACCESSRDR,1'))=1 then '1' else '0' fi
PUTLOG
'LINKCORRTASK=REPKFCH%DBN=RDR%QUERY="KCH=',,v991^C,,,'"%V991=',"^A"v991^C,"^B"v991^3,'^CH%'
FI
//................ для записей каталога - кафедра
//имена БД каталога кладу из G100 в v994
DEL
994
*


ADD
994

(g100/)

REPEAT
PUTLOG
'LINKCORRTASK=REPKFCH%DBN=',,&uf('Av994#1'),,'%QUERY="KAFCH=',,v991^C,,,,,'"%V991=',,"^A"v991^C,"^B"v991^3,'^CH%'
DEL
994
1


UNTIL
if p(v994) then '1' fi
FI
//------------------------
IF
if p(v991^D) then '1' else '0' fi
//------------------------------------------------------- имя дисциплины 
PUTLOG
'Замена имени дисциплины ',v991^D,' на ',v991^4,,if val(v991^[)=1 then '. (Корректировка дополнительных БД каталога в ',,v991^],,')' fi
PUTLOG
'LINKCORRTASK=REPDISC%DBN=VUZ%QUERY="DISCN=',,v991^D,,'"%V991=',,"^A"v991^D,"^B"v991^4,,,,,'^CD%'
//................ для записей каталога - имя дисциплины
//имена БД каталога кладу из G100 в v994
DEL
994
*


ADD
994

(g100/)

REPEAT
PUTLOG
'LINKCORRTASK=REPDISC%DBN=',,&uf('Av994#1'),,'%QUERY="DISC=',,v991^D,,,,'"%V991=',,"^A"v991^D,"^B"v991^4,'^CD%'
DEL
994
1


UNTIL
if p(v994) then '1' fi

FI
//-----------------------
