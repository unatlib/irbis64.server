1
ADDMark.wss
  ВВЕДИТЕ значение для добавления 
// Добавление отсутствующих параметров в записи DISC -> VUZ -> IBIS
// 991 - новое значени
// при изменении факультета или кафедры проверка на добаваление 
// условия для замены:
//?-кафедра; !-факультет;  /-специальность; |-направление; +-ФО; =-ВО
// 2018 - 991^[ - признак подключить доп БД
// 2018 - 991^] - список доп.БД
IF
if v920: 'DISC' then '0' else '1' fi
PUTLOG
'Отмеченные записи должны быть типа DISC!'
FI
IF
if v920:'DISC' then '1' else '0' fi
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
//.................. Новое в 2018, в G100 имена всех БД
IF
if val(v991^[)=1 and v991^]<>'' then '1' fi,,,,&uf('+7W100#',if &unifor('IPRIVATE,DBN,')<>'' then &unifor('IPRIVATE,DBN,') else 'IBIS' fi)
REP
991^]
1
v991^] ,,,if v991^]: '.' then  else '.mnu' fi

ADD
991

(if  &uf('+5T',,&uf('Av991^]#1'),,)<>'' then &uf('+7U100#',&uf('+5T',,&uf('Av991^]#1'),,) ) else break fi/),,&uf('+7G100'),,,

FI


//имена БД каталога кладу из G100 в v994
DEL
994
*


ADD
994

(g100/)

//----------защита от более одного значения
REP
991
1
"^?"v991^?,,"^!"v991^!,,"^/"v991^/,,"^|"v991^|,,"^+"v991^+,,"^="v991^=,,"^A"v991^A,,if a(v991^A) then "^N"v991^N,,if a(v991^N) then "^C"v991^C,,if a(v991^C) then "^V"v991^V,,if a(v991^V) then "^O"v991^O,,if a(v991^O) then "^B"v991^B,,if a(v991^B) then "^S"v991^S,,fi fi fi fi fi fi

DEL
992
*


ADD
992
1
v991

REP
991
1
"^?"v991^?,,"^!"v991^!,,"^/"v991^/,,"^|"v991^|,,"^+"v991^+,,"^="v991^=,,,'^XI^Y',,v3^0,,if v991: '^A' then '^CA^B',v991^A else if v991: '^N' then '^CN^B',v991^N else if v991: '^C' then '^CC^B',v991^C else if v991: '^V' then '^CV^B',v991^V else if v991: '^O' then '^CO^B',v991^O else if v991: '^B' then '^CB^B',v991^B else if v991: '^S' then '^CS^B',v991^S fi fi fi fi fi fi fi,,

IF
if v991: '^CC' then '1' fi
//--------------------------------------------------------------------------специальность
DEL
1083
*


ADD
1083

(v83^C/)

REP
83
F
(if p(v83) then v83,,,if v83^C='' then if &uf('Av991^?#1')='' or &uf('+97',&uf('Av991^?#1'))=&uf('+97',v83^B) then if &uf('Av991^!#1')='' or &uf('+97',&uf('Av991^!#1'))=&uf('+97',v83^A) then if &uf('Av991^|#1')='' or &uf('+97',&uf('Av991^|#1'))=&uf('+97',v83^N) then if &uf('Av991^+#1')='' or &uf('+97',&uf('Av991^+#1'))=&uf('+97',v83^O) then if &uf('Av991^=#1')='' or &uf('+97',&uf('Av991^=#1'))=&uf('+97',v83^V) then '^C',,&uf('Av991^B#1') fi,fi,fi,fi,fi,fi,fi/)

IF
if &uf('+97',v1083)<>&uf('+97',v83^C) then '1' fi
PUTLOG
'Добавлено в записи DISC - ',v3^A,'. MFN=',f(val(mfn),0,0)
DEL
1083
*


//----------^C изменилось
FI
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
//---------конец специальности
FI
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
IF
if v991: '^CN' then '1' fi
//----------------------------------------------------------------------направление
DEL
1083
*


ADD
1083

(v83^N/)

REP
83
F
(if p(v83)  then v83,,,if v83^N='' then if &uf('Av991^?#1')='' or &uf('+97',&uf('Av991^?#1'))=&uf('+97',v83^B) then if &uf('Av991^!#1')='' or &uf('+97',&uf('Av991^!#1'))=&uf('+97',v83^A) then if &uf('Av991^/#1')='' or &uf('+97',&uf('Av991^/#1'))=&uf('+97',v83^C) then if &uf('Av991^+#1')='' or &uf('+97',&uf('Av991^+#1'))=&uf('+97',v83^O) then if &uf('Av991^=#1')='' or &uf('+97',&uf('Av991^=#1'))=&uf('+97',v83^V) then '^N',,&uf('Av991^B#1') fi,fi,fi,fi,fi,fi,fi/)

IF
if &uf('+97',v1083)<>&uf('+97',v83^N) then '1' fi,,,,&uf('+7W10#')
PUTLOG
'Добавлено в записи DISC - ',v3^A,'. MFN=',f(val(mfn),0,0)
DEL
1083
*


//----------^N изменилось
FI
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
//---------конец направления
FI
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
IF
if v991: '^CA' then '1' fi
//---------------------------------------------------------------------------факультет
DEL
1083
*


ADD
1083

(v83^A/)

REP
83
F
(if p(v83) then v83,,,if v83^A='' then if &uf('Av991^?#1')='' or &uf('+97',&uf('Av991^?#1'))=&uf('+97',v83^B) then if &uf('Av991^/#1')='' or &uf('+97',&uf('Av991^/#1'))=&uf('+97',v83^C) then if &uf('Av991^|#1')='' or &uf('+97',&uf('Av991^|#1'))=&uf('+97',v83^N) then if &uf('Av991^+#1')='' or &uf('+97',&uf('Av991^+#1'))=&uf('+97',v83^O) then if &uf('Av991^=#1')='' or &uf('+97',&uf('Av991^=#1'))=&uf('+97',v83^V) then '^A',,&uf('Av991^B#1') fi,fi,fi,fi,fi,fi,fi/)

IF
if &uf('+97',v1083)<>&uf('+97',v83^A) then '1' fi
PUTLOG
'Добавлено в записи DISC - ',v3^A,'. MFN=',f(val(mfn),0,0)
DEL
1083
*


//----------^C изменилось
FI
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
//---------конец факультета
FI
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
IF
if v991: '^CO' then '1' fi
//-------------------------------------------------------------------------------формы обучения
DEL
1083
*


ADD
1083

(v83^O/)

REP
83
F
(if p(v83)  then v83,,,if v83^O=''  then if &uf('Av991^?#1')='' or &uf('+97',&uf('Av991^?#1'))=&uf('+97',v83^B) then if &uf('Av991^!#1')='' or &uf('+97',&uf('Av991^!#1'))=&uf('+97',v83^A) then if &uf('Av991^|#1')='' or &uf('+97',&uf('Av991^|#1'))=&uf('+97',v83^N) then if &uf('Av991^/#1')='' or &uf('+97',&uf('Av991^/#1'))=&uf('+97',v83^C) then if &uf('Av991^=#1')='' or &uf('+97',&uf('Av991^=#1'))=&uf('+97',v83^V) then '^O',,&uf('Av991^B#1') fi,fi,fi,fi,fi,fi,fi/)

IF
if &uf('+97',v1083)<>&uf('+97',v83^O) then '1' fi
PUTLOG
'Добавлено в записи DISC - ',v3^A,'. MFN=',f(val(mfn),0,0)
DEL
1083
*


//----------^C изменилось
FI
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
//---------конец форма обучения
FI
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
IF
if v991: '^CV' then '1' fi
//---------------------------------------------------------------------------вид обучения
DEL
1083
*


ADD
1083

(v83^V/)

REP
83
F
(if p(v83) then v83,,,if v83^V=''  then if &uf('Av991^?#1')='' or &uf('+97',&uf('Av991^?#1'))=&uf('+97',v83^B) then if &uf('Av991^!#1')='' or &uf('+97',&uf('Av991^!#1'))=&uf('+97',v83^A) then if &uf('Av991^|#1')='' or &uf('+97',&uf('Av991^|#1'))=&uf('+97',v83^N) then if &uf('Av991^/#1')='' or &uf('+97',&uf('Av991^/#1'))=&uf('+97',v83^C) then if &uf('Av991^+#1')='' or &uf('+97',&uf('Av991^+#1'))=&uf('+97',v83^O) then '^V',,&uf('Av991^B#1') fi,fi,fi,fi,fi,fi,fi/)

IF
if &uf('+97',v1083)<>&uf('+97',v83^V) then '1' fi
PUTLOG
'Добавлено в записи DISC - ',v3^A,'. MFN=',f(val(mfn),0,0)
DEL
1083
*


//----------^C изменилось
FI
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
//---------конец вид обучения
FI
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
IF
if v991: '^CB' then '1' fi
//-------------------------------------------------------------------------------кафедра
IF
if a(v5) then '1' fi
ADD
5

v991^B

PUTLOG
'Добавлено в записи DISC - ',v3^A,'. MFN=',f(val(mfn),0,0)
FI
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
//---------конец кафедра
FI
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
IF
if v991: '^CS' then '1' fi
//--------------------------------------------------------------------------цикл
IF
if a(v4) then '1' fi
ADD
4

v991^B

PUTLOG
'Добавлено в записи DISC - ',v3^A,'. MFN=',f(val(mfn),0,0)
FI
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
//---------конец цикл
FI
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
//-----------------------------корректирую записи VUZ - не для кафедры и цикла
IF
if v991: '^CS' or v991: '^CB' then else '1' fi
CORREC
'*'
mpu,v3^0
'IDV=',,v3^0,

//..................старые записи - удаляю 69 дисциплины
DEL
69
F
(if p(v69) then if &uf('+97',v69^D)=&uf('Av1001#1') then '1' else '0' fi fi/)

DEL
1001
*


END
//.................на создание новых VUZ
PUTLOG
'LINKCORRTASK=LinkDisc%DBN=VUZ',,,'%QUERY="IDD=',,v3^0,,,'"'
FI
//2018-----------------------------------------цикл по БД каталога по полю 994
REPEAT
//------------задание для каталога - для спец,напр,фак,во,фо,сем,каф,цикл
PUTLOG
'БД каталога ',,&uf('Av994#1')
PUTLOG
'LINKCORRTASK=REPCNA_M%DBN=',,&uf('Av994#1') ,,'%QUERY="IDD=',,v3^0,,,'"%V991=',,v991,'%'
DEL
994
1


UNTIL
if p(v994) then '1' fi

//------------------------------------------конец запись DISC
FI
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
DEL
991
*


DEL
992
*


DEL
1083
*


