0
// продление на отмеченной записи абонента
// 991^A - новая дата возврата
// 991^B - на кол-во дней 
// 991^C - номер отмеченного заказа
DEL
992
*


ADD
992

mpu,(v991/),,,,

REPEAT
//----------------------------------- цикл по отмеченным заказам по записи абонента
//----------------------------------- замена даты в поле 40 абонента
//---на сколько дней продлено в g11
REP
40^E
F
&uf('+7W11#'),,,,(if p(v40)  then if v40^E<>'' then  if &uf('+97',v40^B)=&uf('Av992^C#1') then &uf('+7W13#',v40^E),,,,,&uf('+7W12#', if &uf('Av992^B#1')<>'' then &uf('3B',,v40^E,,,,'/',&uf('Av992^B#1') ),,,,,else &uf('Av992^A#1')  fi  ),,,,,&uf('+7W11#',,&uf('3C',&uf('Ag12#1'),'/',&uf('Ag13#1')) ),,,,&uf('Ag12#1') else v40^E fi else # fi fi/)

/*---------в запись заказа
CORREC
'*'
&uf('Av992#1')
'QAB=',v100,' - ',&uf('Av992^C#1')

IF
if &uf('Av942^A#',,,&uf('+N942') )=&uf('IRequest,MBASTATUSLAND,O1') then '1' fi,,,,,,,&uf('+7W10#',,,if &uf('Av1001^B#1')<>'' then &uf('3B',,v942^C,,,,'/',&uf('Av1001^B#1') ),,,else &uf('Av1001^A#1') fi   ),
//----------------------------------- добавление поля  942 в заказе
ADD
942

'^A',&uf('IRequest,MBASTATUSLONG,O2'),,,'^C',&uf('3'),,,'^H',g11

PUTLOG
v30^A,,' - заказ откорректирован. MFN=',,f(val(mfn),0,0)
FI
DEL
1001
*


END
DEL
992
1


UNTIL
if p(v992) then '1' fi
PUTLOG
v100,' - абонент откорректирован'
DEL
991
*


