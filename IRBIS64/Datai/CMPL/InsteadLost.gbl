0
//----выполняется на записи КСУ взамен по полям 80
DEL
1080
*


ADD
1080

(v80/)

REPEAT
//------ задан признак - в той же книге?
IF
if val(&uf('Av1080^1#1'))=1 then '1' fi
//----- проверяю наличие БД 
IF
if val(&uf('+9L1,',,&uf('Av1080^C#1'),,',',,&uf('Av1080^C#1'),,'.par'))=0 then '1' fi
PUTLOG
&uf('Av1080^C#1'),,': недоступна'
FI
IF
if &uf('+9L1,',,&uf('Av1080^C#1'),,',',,&uf('Av1080^C#1'),,'.par')='1' then '1' fi
IF
if val(&uf('J',,&uf('Av1080^C#1'),,',IN=',,&uf('Av1080^B#1') ) )>0 or val(&uf('J',,&uf('Av1080^C#1'),,',IN=',,&uf('Av1080^H#1') ) )>0 then '1' fi
PUTLOG
&uf('Av1080^C#1'),,': ',,&uf('Av1080^B#1'),,if &uf('Av1080^B#1')='' then &uf('Av1080^H#1') fi,': экземпляр уже есть'
FI
IF
if val(&uf('J',,&uf('Av1080^C#1'),,',IN=',,&uf('Av1080^B#1') ) )>0 or val(&uf('J',,&uf('Av1080^C#1'),,',IN=',,&uf('Av1080^H#1') ) )>0 then else '1' fi
//-----экземпляр еще не введен - запись ищу по утерянному
CORREC
&uf('Av1080^C#1')
&uf('Av1080#1'),'^U',,&uf('Av88^A#1')
'EXU=',,&uf('Av1080^A#1') 

ADD
910

'^A0',,,if &uf('Av1001^B#1')<>'' then '^B',&uf('Av1001^B#1') else '^H',&uf('Av1001^H#1') fi,,,'^U',&uf('Av1001^U#1') ,,,,'^C',&uf('3')

PUTLOG
&uf('Av1001^C#1'),,': MFN=',,f(val(mfn),0,0),' - добавлен экземпляр ',&uf('Av1001^B#1'),&uf('Av1001^H#1')
PUTLOG
'!!!',f(val(mfn),0,0),,'!!!',,&uf('Av1001^C#1')
DEL
1001
*


END
//---конец экземпляр не введен
FI
//------конец проверки БД
FI
//-----конец той же книге
FI
DEL
1080
1


UNTIL
if p(v1080) then  '1' fi
