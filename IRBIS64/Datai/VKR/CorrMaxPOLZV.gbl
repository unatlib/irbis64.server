0
// корректировка макс. нивентаря в БД CMPL по новым инвент-м, которые в поле 991
// используется в Мастере поступления при сохранении в ЭК
IF
&uf('+7W1#',&uf('DCMPL,?VD=POLZV?,(v910/)')),,,if rsum((if p(G1) then '1,' fi))<=val(&uf('IMAIN,MAX910Polzv,50')) then '1' fi
CORREC
'CMPL'
(v991/)
'VD=POLZV'
XXXXXXXXXXXXXXXXXX
ADD
910

if a(v910) then '1' fi

// прочитаем модель из ini-файла
DEL
2
*
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
ADD
2
XXXXXXXXXXXXXXXXXXX
&unifor('IMAIN,MODEINVENT,'),,,&uf('+7W910#',v910|?|)
XXXXXXXXXXXXXXXXXXX
DEL
9101
*
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
ADD
9101
XXXXXXXXXXXXXXXXXXX
(V910/)
XXXXXXXXXXXXXXXXXXX
// цикл по внешним инвентарным номерам из v1001, т.е. по инвентарям записи
REPEAT
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
DEL
1
*
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
ADD
1
XXXXXXXXXXXXXXXXXXX
if v1001<>'' then if G910='' then &unifor('+XMIN=#',&unifor('Av1001#1'),if v2<>'' then '#',v2 fi) else &unifor('+W',,G910,,'#',&unifor('Av1001#1'),if v2<>'' then '#',v2 fi) fi fi
XXXXXXXXXXXXXXXXXXX
// в v1 вариант замены
IF
if p(v1) then '1' else '0' fi
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
IF
if v1: '@' then '0' else '1' fi
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
// НЕ добавляю новое, если в процедуре строка не изменилась
ADD
9101
XXXXXXXXXXXXXXXXXXX
mpu,if &uf('+97',&uf('Av1001#1'))=&uf('+97',v1) then else v1 fi
XXXXXXXXXXXXXXXXXXX
FI
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
IF
if v1: '@' then '1' else '0' fi
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
REP
9101
F
mpu,(if p(v9101) then if v9101=&unifor('G0@',&unifor('Av1#1')) then &unifor('G2@',&unifor('Av1#1')) else v9101 fi fi/)
XXXXXXXXXXXXXXXXXXX
FI
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
//заново G910
ADD
1

&uf('+7W910#',v9101|?|)

FI
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
DEL
1001
1
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
DEL
1
*
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
UNTIL
if p(v1001) then '1' else '0' fi
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
// новые значения поля 910 в переменную G10
ADD
910

&uf('+7W10#',(V9101/)),&uf('+7G10')

DEL
9101
*
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
DEL
2
*
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
DEL
1001
*


END
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
// на реальную замену поля 910
CORREC
'CMPL'
(G10/)
'VD=POLZV'
XXXXXXXXXXXXXXXXXX
DEL
910
*
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
// новые значения поля 910
ADD
910

(v1001/)

DEL
1001
*


DEL
1
*


DEL
2
*


END
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXX
FI
