0
//-----------создание новой записи КСУ выбытия
//991^A - номер КСУ
//991^Y -  номер сопровод док-та
//991^B -  дата
//991^D -  место хранения списания
//991^G -  причина выбытия
//--------------добавление поля 44 через g10
ADD
111

&uf('+7W10#',,,if v910^v: v991^A then (if p(v910) then if &uf('+97',v910^v)=&uf('Av991^A#1') then if v910^a:'6' or p(v910^x)  then  '^i'v910^d, if &uf('Av900^b#1')<>'' then  '^h',,&uf('Av900^b.2#1') else  if &uf('+97',&uf('Av920#1'))='NJ' then '^h02' fi fi  fi  fi fi/)  fi/ )

IF
if g10<>'' then '1' fi
//-------------------------------на корректировку КСУ
IF
if val(&uf('DCMPL,!PKS2=',,v991^A,,'!,mfn'))>0 then '1' fi
//-------------------корректировка существующей записи
CORREC
'CMPL'
(g10/)
"PKS2="v991^A

ADD
111

&uf('+7W11#',,(|^I|v44^I,|^H|v44^H/) ),,,,&uf('+7U11#',(v1001/) ),,,&uf('+7G11'),,,,,,

DEL
44
*


ADD
44

(g11/)

DEL
744
*


ADD
744

(g11/)

DEL
17
*


DEL
18
*


DEL
19
*


DEL
45
*


DEL
47
*


DEL
48
*


DEL
49
*


DEL
145
*


DEL
146
*


DEL
147
*


DEL
148
*


DEL
149
*


DEL
150
*


DEL
151
*


DEL
155
*


DEL
156
*


DEL
910
*


DEL
20
*


DEL
21
*


DEL
1001
*


END
FI
//---------------------создание новой записи КСУ
IF
if val(&uf('DCMPL,!PKS2=',,v991^A,,'!,mfn'))=0 then '1' fi
NEWMFN
'CMPL'
ADD
920

'KS2'

ADD
888

"^A"v991^A,,,"^C"v991^Y,,,"^B"v991^B,,,"^D"v991^D,,,,"^P"v991^G,,,,&uf('+7G10'),,

REP
888
1
v888,,if v888^B='' then '^B',&uf('3') fi

ADD
44

(g10/)

ADD
744

(G10/)

PUTLOG
'Создана запись КСУ ',,v991^A,,
END
FI
//----------------------------------добавление поля 744 через g10






//--------------------конец на корректировку
FI
DEL
111
*


DEL
991
*


