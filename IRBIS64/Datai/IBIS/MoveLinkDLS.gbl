0
// св€зь записи каталога с записью ЁЅ—
// перенос ссылок (только ^I) в поле 951 записи по шифру
// на входе записи ЁЅ— с ссылками в 951
// в 992 шифр записи каталога, куда переносить
// в 993^A им€ Ѕƒ каталога
// 993^B - 1 удал€ть ссылки в каталоге, если переноситс€ нова€
// 993^C - 1 удал€ть пол€ 691 в ЁЅ—, если перенос€тс€
// в 991 пол€ 691, которые перенос€тс€ из каталога в записи ЁЅ—
IF
if p(v951) then '1' fi
//-----------перенос в запись каталога ссылки из пол€ 951 Ё” с признаком удалени€ старых
CORREC
if v993^A<>'' then v993^A else v993 fi,,,
if val(v993^B)=1 then '^@1'/(v951/) else (v951/) fi,
'I=',v992

// признак удалени€ старых ссылок
IF
if &uf('Av1001^@#1')<>'' then '1' fi
DEL
951
*


FI
DEL
1002
*


ADD
1002

(v951^I)

REPEAT
ADD
951

if &uf('Av1001^I#1')<>'' then  if a(v951) or rsum((if p(v951) then if &uf('+97',v951^I)=&uf('+97',&uf('Av1001^I#1')) then '1,' fi fi))=0 then &uf('Av1001#1'),,,if &uf('Av1001^K#1')='' then '^K1' fi,,,, fi fi

DEL
1001
1


UNTIL
if p(v1001) then '1' fi
IF
if v1002<>(v951^I) then '1' fi
PUTLOG
&uf('+D'),,': MFN=',f(val(mfn),0,0),,,' - в запись добавлена ссылка в поле 951'
FI
DEL
1001
*


DEL
1002
*


END
//---конец переноса ссылок в каталог
FI
IF
if p(v991) then '1' fi
// --------------------------------------добавление полей 691 в записи ЁЅ—= DLS
PUTLOG
&uf('+D'),,': MFN=',f(val(mfn),0,0),,,' - в запись добавлены пол€  691'
DEL
1991
*


ADD
1991

(v991/)

//----с удалением полей 691?
IF
if v993^C<>'' then '1' fi
DEL
691
*


FI
REPEAT
ADD
691

if rsum((if p(v691) then if &uf('+97',v691^I)=&uf('+97',&uf('Av1991^I#1')) and &uf('+97',v691^D)=&uf('+97',&uf('Av1991^D#1')) and &uf('+97',v691^A)=&uf('+97',&uf('Av1991^A#1')) and &uf('+97',v691^N)=&uf('+97',&uf('Av1991^N#1')) and &uf('+97',v691^C)=&uf('+97',&uf('Av1991^C#1')) and &uf('+97',v691^B)=&uf('+97',&uf('Av1991^B#1')) and &uf('+97',v691^S)=&uf('+97',&uf('Av1991^S#1')) and &uf('+97',v691^K)=&uf('+97',&uf('Av1991^K#1')) and &uf('+97',v691^V)=&uf('+97',&uf('Av1991^V#1')) and &uf('+97',v691^O)=&uf('+97',&uf('Av1991^O#1')) and &uf('+97',v691^G)=&uf('+97',&uf('Av1991^G#1')) and val(v691^F)=val(&uf('Av1991^F#1'))  then '1,' fi fi)) =0 then &uf('Av1991#1') fi

DEL
1991
1


UNTIL
if p(v1991) then '1' fi
//----конец добавлени€ 691
FI
//--------------- признак Ё” в поле 951 ЁЅ—
IF
if p(v951) then '1' fi
REP
951
1
&uf('Av951#1'),,,if &uf('Av951^K#1')='' then '^K1' fi

FI
DEL
991
*


DEL
992
*


DEL
993
*


